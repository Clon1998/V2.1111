[gcode_macro M600]
gcode:
    {% set X = params.X|default(230)|float %}
    {% set Y = params.Y|default(0)|float %}
    {% set Z = params.Z|default(20)|float %}
    {% set E = params.E|default(1)|float %}
    SAVE_GCODE_STATE NAME=M600_state
    SAVE_GCODE_STATE NAME=PAUSE_state
    BASE_PAUSE
    G91
    G1 E-{E} F2100
    G1 Z{Z}
    G90
    G1 X{X} Y{Y} F6000
    G91
    G1 E-100 F500
    RESTORE_GCODE_STATE NAME=M600_state

[gcode_macro M602]
gcode:
    {% set E = params.E|default(1)|float %}
    G91
    G1 E{E} F2100
    G90
    RESTORE_GCODE_STATE NAME=PAUSE_state MOVE=1
    BASE_RESUME

[gcode_macro LOAD_FILAMENT]
gcode:
    {% set E = params.E|default(100)|float %}
    SAVE_GCODE_STATE NAME=LOADFILA_state
    G91
    G1 E{E} F500
    G1 E-1 F2100
    RESTORE_GCODE_STATE NAME=LOADFILA_state
